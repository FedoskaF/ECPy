
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>ecpy.curves &#8212; ECPy 1.0beta. documentation</title>
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ecpy.curves</h1><div class="highlight"><pre>
<span></span><span class="c1"># encoding: UTF-8</span>

<span class="c1"># Copyright 2016-2017 Cedric Mesnil &lt;cedric.mesnil@ubinity.com&gt;, Ubinity SAS</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>


<span class="sd">&quot;&quot;&quot; Elliptic Curve and Point manipulation</span>

<span class="sd">.. moduleauthor:: Cédric Mesnil &lt;cedric.mesnil@ubinity.com&gt;</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="c1">#python 2 compatibility</span>
<span class="kn">from</span> <span class="nn">builtins</span> <span class="kn">import</span> <span class="nb">int</span><span class="p">,</span><span class="nb">pow</span>

<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">curve_defs</span>




<div class="viewcode-block" id="Curve"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve">[docs]</a><span class="k">class</span> <span class="nc">Curve</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Elliptic Curve abstraction</span>

<span class="sd">    You should not directly create such Object.</span>
<span class="sd">    Use `get_curve` to get the predefined curve or create a well-know type</span>
<span class="sd">    of curve with your parameters</span>

<span class="sd">    Supported well know elliptic curve are:</span>
<span class="sd">       - Short Weierstrass form:  y²=x³+a*x+b</span>
<span class="sd">       - Twisted Edward           a*x²+y2=1+d*x²*y²</span>
<span class="sd">       - Montgomery:              b.y²=x³+a*x²+x.</span>

<span class="sd">    Attributes:</span>
<span class="sd">       name (str)       : curve name, the one given to get_curve or return by get_curve_names</span>
<span class="sd">       size (int)       : bit size of curve</span>
<span class="sd">       a (int)          : first curve parameter</span>
<span class="sd">       b d (int)        : second curve parameter</span>
<span class="sd">       field (int)      : curve field</span>
<span class="sd">       generator (Point): curve point generator</span>
<span class="sd">       order (int)      : order of generator</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_curves_cache</span> <span class="o">=</span> <span class="p">{}</span>


<div class="viewcode-block" id="Curve.get_curve"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.get_curve">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_curve</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a Curve object  according to its name</span>

<span class="sd">       Args:</span>
<span class="sd">           name (str) : curve name to retrieve</span>

<span class="sd">       Returns:</span>
<span class="sd">           Curve:          Curve object, or None if curve is unknown</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">Curve</span><span class="o">.</span><span class="n">_curves_cache</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Curve</span><span class="o">.</span><span class="n">_curves_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="n">l</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curve_defs</span><span class="o">.</span><span class="n">curves</span> <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">name</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">cp</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curve_defs</span><span class="o">.</span><span class="n">WEIERSTRASS</span><span class="p">:</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="n">WeierstrassCurve</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cp</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curve_defs</span><span class="o">.</span><span class="n">TWISTEDEDWARD</span><span class="p">:</span>
            <span class="n">cv</span> <span class="o">=</span>  <span class="n">TwistedEdwardCurve</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">cp</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">curve_defs</span><span class="o">.</span><span class="n">MONTGOMERY</span><span class="p">:</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="n">MontgomeryCurve</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cv</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">cv</span> <span class="p">:</span>
            <span class="n">Curve</span><span class="o">.</span><span class="n">_curves_cache</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">cv</span>

        <span class="k">return</span> <span class="n">cv</span></div>

<div class="viewcode-block" id="Curve.get_curve_names"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.get_curve_names">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_curve_names</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot; Returns all known curve names</span>

<span class="sd">        Returns:</span>
<span class="sd">          tuple:  list of names as str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">curve_defs</span><span class="o">.</span><span class="n">curves</span><span class="p">]</span></div>


    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parameters</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method __init__&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span> <span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">[</span><span class="s1">&#39;generator&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">[</span><span class="s1">&#39;generator&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">[</span><span class="s1">&#39;generator&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_domain</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="Curve.is_on_curve"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.is_on_curve">[docs]</a>    <span class="k">def</span> <span class="nf">is_on_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if P is on this curve</span>

<span class="sd">        This function ignores the default curve attach to P</span>

<span class="sd">        Args:</span>
<span class="sd">            P (Point): Point to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if P is on curve, False else</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method is_on_curve&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Curve.add_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.add_point">[docs]</a>    <span class="k">def</span> <span class="nf">add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the sum of P and Q</span>

<span class="sd">        Args:</span>
<span class="sd">            P (Point): first  point to add</span>
<span class="sd">            Q (Point): second point to add</span>

<span class="sd">        Returns:</span>
<span class="sd">            Point: A new Point R = P+Q</span>

<span class="sd">        Raises:</span>
<span class="sd">             ECPyException : with &quot;Point not on curve&quot;, if Point R is not on \</span>
<span class="sd">             curve,  thus meaning either P or Q was not on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">P</span><span class="o">+</span><span class="n">Q</span></div>

<div class="viewcode-block" id="Curve.sub_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.sub_point">[docs]</a>    <span class="k">def</span> <span class="nf">sub_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the difference of P and Q</span>

<span class="sd">        Args:</span>
<span class="sd">            P (Point): first  point to subtract with</span>
<span class="sd">            Q (Point): second point to subtract to</span>

<span class="sd">        Returns:</span>
<span class="sd">            Point: A new Point R = P-Q</span>

<span class="sd">        Raises:</span>
<span class="sd">             ECPyException : with &quot;Point not on curve&quot;, if Point R is not on \</span>
<span class="sd">             curve,  thus meaning either P or Q was not on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">P</span><span class="o">-</span><span class="n">Q</span></div>

<div class="viewcode-block" id="Curve.mul_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.mul_point">[docs]</a>    <span class="k">def</span> <span class="nf">mul_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the scalar multiplication  P with k.</span>

<span class="sd">        This function ignores the default curve attach to P and Q,</span>
<span class="sd">        and assumes P and Q are on this curve.</span>

<span class="sd">        Args:</span>
<span class="sd">            P (Point): point to mul_point</span>
<span class="sd">            k (int)  : scalar to multiply</span>

<span class="sd">        Returns:</span>
<span class="sd">            Point: A new Point R = k*Q</span>

<span class="sd">        Raises:</span>
<span class="sd">            ECPyException : with &quot;Point not on curve&quot;, if Point R is not</span>
<span class="sd">            on curve, thus meaning P was not on.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">k</span><span class="o">*</span><span class="n">P</span></div>

<div class="viewcode-block" id="Curve.neg_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.neg_point">[docs]</a>    <span class="k">def</span> <span class="nf">neg_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns R, R = -P.</span>

<span class="sd">        Args:</span>
<span class="sd">            P (Point): point to mul_point</span>

<span class="sd">        Returns:</span>
<span class="sd">            Point: A new Point R = -Q</span>

<span class="sd">        Raises:</span>
<span class="sd">            ECPyException : with &quot;Point not on curve&quot;, if Point R is not</span>
<span class="sd">            on curve, thus meaning P was not on.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">P</span></div>

    <span class="k">def</span> <span class="nf">_add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method add_point&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mul_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method mul_point&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_neg_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method neg_point&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Curve.y_recover"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.y_recover">[docs]</a>    <span class="k">def</span> <span class="nf">y_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Recover the y coordinate according to x</span>

<span class="sd">        This method is currently only  supported for Weierstrass and Montgomery curve</span>

<span class="sd">        Args:</span>
<span class="sd">            x the coordinate</span>
<span class="sd">            sign the sign of y</span>

<span class="sd">        Returns:</span>
<span class="sd">           y coordinate</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method y_recover&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Curve.x_recover"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.x_recover">[docs]</a>    <span class="k">def</span> <span class="nf">x_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Recover the x coordinate according to y</span>

<span class="sd">        This method is currently only supported for TwiestedEdward curve</span>

<span class="sd">        Args:</span>
<span class="sd">            y the coordinate</span>
<span class="sd">            sign the sign of x</span>

<span class="sd">        Returns:</span>
<span class="sd">           x coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method x_recover&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Curve.encode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.encode_point">[docs]</a>    <span class="k">def</span> <span class="nf">encode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; encode/compress a point according to its curve&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method encode_point&#39;</span><span class="p">)</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Curve.decode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.Curve.decode_point">[docs]</a>    <span class="k">def</span> <span class="nf">decode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eP</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; decode/decompress a point according to its curve&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Abstract method _point decode_point&#39;</span><span class="p">)</span>

        <span class="k">pass</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generic Tonelli–Shanks algorithm &quot;&quot;&quot;</span>

        <span class="c1">#check Euler criterion</span>
        <span class="k">if</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1">#compute square root</span>
        <span class="n">p_1</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">q</span> <span class="o">=</span> <span class="n">p_1</span>
        <span class="k">while</span> <span class="n">q</span> <span class="o">&amp;</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">&gt;&gt;</span><span class="mi">1</span>
            <span class="n">s</span>  <span class="o">=</span> <span class="n">s</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,(</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">while</span> <span class="nb">pow</span><span class="p">(</span><span class="n">z</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">c</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,(</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">q</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">s</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">pow</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">i</span><span class="p">),</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">break</span>
                    <span class="n">b</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">m</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>
                    <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>   <span class="o">%</span><span class="n">p</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">)</span> <span class="o">%</span><span class="n">p</span>
                    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">)</span>   <span class="o">%</span><span class="n">p</span>
                    <span class="n">m</span> <span class="o">=</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">r</span><span class="o">&amp;</span><span class="mi">1</span> <span class="o">!=</span> <span class="n">sign</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="n">r</span>
        <span class="k">return</span> <span class="n">r</span></div>


<div class="viewcode-block" id="WeierstrassCurve"><a class="viewcode-back" href="../../index.html#ecpy.curves.WeierstrassCurve">[docs]</a><span class="k">class</span> <span class="nc">WeierstrassCurve</span><span class="p">(</span><span class="n">Curve</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An elliptic curve defined by the equation: y²=x³+a*x+b.</span>

<span class="sd">        The given domain must be a dictionary providing the following keys/values:</span>
<span class="sd">              - name (str)         : curve unique name</span>
<span class="sd">              - size (int)         : bit size</span>
<span class="sd">              - a    (int)         : `a` equation coefficient</span>
<span class="sd">              - b    (int)         : `b` equation coefficient</span>
<span class="sd">              - field (inf)        : field value</span>
<span class="sd">              - generator (int[2]) : x,y coordinate of generator</span>
<span class="sd">              - order (int)        : order of generator</span>
<span class="sd">              - cofactor (int)     : cofactor</span>

<span class="sd">        *Note*: you should not use the constructor and only use :func:`Curve.get_curve`</span>
<span class="sd">        builder to ensure using supported curve.</span>

<span class="sd">        Args:</span>
<span class="sd">           domain (dict): a dictionary providing curve parameters</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Built an new short Weierstrass curve with the provided parameters. &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="s1">&#39;size&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;generator&#39;</span><span class="p">,</span><span class="s1">&#39;order&#39;</span><span class="p">,</span><span class="s1">&#39;cofactor&#39;</span><span class="p">))</span>


<div class="viewcode-block" id="WeierstrassCurve.is_on_curve"><a class="viewcode-back" href="../../index.html#ecpy.curves.WeierstrassCurve.is_on_curve">[docs]</a>    <span class="k">def</span> <span class="nf">is_on_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.is_on_curve` &quot;&quot;&quot;</span>
        <span class="n">q</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">x</span>     <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="n">sq3x</span>  <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">y</span>     <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">y</span>
        <span class="n">sqy</span>   <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">left</span>  <span class="o">=</span> <span class="n">sqy</span>
        <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">sq3x</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span></div>


<div class="viewcode-block" id="WeierstrassCurve.y_recover"><a class="viewcode-back" href="../../index.html#ecpy.curves.WeierstrassCurve.y_recover">[docs]</a>    <span class="k">def</span> <span class="nf">y_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="n">p</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
        <span class="n">y</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqrt</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">sign</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="WeierstrassCurve.encode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.WeierstrassCurve.encode_point">[docs]</a>    <span class="k">def</span> <span class="nf">encode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">compressed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Encodes a point P according to *P1363-2000*.</span>

<span class="sd">        Args:</span>
<span class="sd">            P: point to encode</span>

<span class="sd">        Returns:</span>
<span class="sd">           bytes : encoded point [04 | x | y] or [02 | x | sign]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">&gt;&gt;</span><span class="mi">3</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">))</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">compressed</span><span class="p">:</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span> <span class="o">|</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">enc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">enc</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">enc</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">enc</span></div>

<div class="viewcode-block" id="WeierstrassCurve.decode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.WeierstrassCurve.decode_point">[docs]</a>    <span class="k">def</span> <span class="nf">decode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eP</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Decodes a point P according to *P1363-2008*.</span>

<span class="sd">        Args:</span>
<span class="sd">            eP (bytes)    : encoded point</span>
<span class="sd">            curve (Curve) : curve on witch point is</span>
<span class="sd">        Returns:</span>
<span class="sd">           Point : decoded point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">&gt;&gt;</span><span class="mi">3</span>
        <span class="n">xy</span>    <span class="o">=</span>  <span class="nb">bytearray</span><span class="p">(</span><span class="n">eP</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="o">+</span><span class="n">size</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_recover</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="o">+</span><span class="n">size</span><span class="p">]</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="o">+</span><span class="n">size</span><span class="p">:</span><span class="mi">1</span><span class="o">+</span><span class="n">size</span><span class="o">+</span><span class="n">size</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;big&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s2">&quot;Invalid encoded point&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.add_point` &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">Q</span><span class="p">):</span>
            <span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2jac</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_jac</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2jac</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">Qx</span><span class="p">,</span><span class="n">Qy</span><span class="p">,</span><span class="n">Qz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2jac</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">Q</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_jac</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span><span class="p">,</span> <span class="n">Qx</span><span class="p">,</span><span class="n">Qy</span><span class="p">,</span><span class="n">Qz</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">z</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jac2aff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="k">return</span>  <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_infinity_point</span>

    <span class="k">def</span> <span class="nf">_mul_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.mul_point` &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2jac</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_jac</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sz</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span> <span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_jac</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_jac</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_jac</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
                <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_jac</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">z1</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jac2aff</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_infinity_point</span>

    <span class="k">def</span> <span class="nf">_neg_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">-</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_aff2jac</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_jac2aff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">invz</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="n">sqinvz</span> <span class="o">=</span> <span class="p">(</span><span class="n">invz</span><span class="o">*</span><span class="n">invz</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">sqinvz</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">sqinvz</span><span class="o">*</span><span class="n">invz</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>


    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_dbl_jac</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">Y1</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="n">XX</span>   <span class="o">=</span> <span class="p">(</span><span class="n">X1</span><span class="o">*</span><span class="n">X1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">YY</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y1</span><span class="o">*</span><span class="n">Y1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">YYYY</span> <span class="o">=</span> <span class="p">(</span><span class="n">YY</span><span class="o">*</span><span class="n">YY</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">ZZ</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Z1</span><span class="o">*</span><span class="n">Z1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">S</span>    <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">X1</span><span class="o">+</span><span class="n">YY</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">X1</span><span class="o">+</span><span class="n">YY</span><span class="p">)</span><span class="o">-</span><span class="n">XX</span><span class="o">-</span><span class="n">YYYY</span><span class="p">))</span><span class="o">%</span><span class="n">q</span>
        <span class="n">M</span>    <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">XX</span><span class="o">+</span><span class="n">a</span><span class="o">*</span><span class="n">ZZ</span><span class="o">*</span><span class="n">ZZ</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">T</span>    <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">M</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">S</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">X3</span>   <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Y3</span>   <span class="o">=</span> <span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="p">(</span><span class="n">S</span><span class="o">-</span><span class="n">T</span><span class="p">)</span><span class="o">-</span><span class="mi">8</span><span class="o">*</span><span class="n">YYYY</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Z3</span>   <span class="o">=</span> <span class="p">((</span><span class="n">Y1</span><span class="o">+</span><span class="n">Z1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Y1</span><span class="o">+</span><span class="n">Z1</span><span class="p">)</span><span class="o">-</span><span class="n">YY</span><span class="o">-</span><span class="n">ZZ</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="n">X3</span><span class="p">,</span><span class="n">Y3</span><span class="p">,</span><span class="n">Z3</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_jac</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">Y1</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span> <span class="n">X2</span><span class="p">,</span><span class="n">Y2</span><span class="p">,</span><span class="n">Z2</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">Z1Z1</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z1</span><span class="o">*</span><span class="n">Z1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Z2Z2</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z2</span><span class="o">*</span><span class="n">Z2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">U1</span>   <span class="o">=</span> <span class="p">(</span><span class="n">X1</span><span class="o">*</span><span class="n">Z2Z2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">U2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">X2</span><span class="o">*</span><span class="n">Z1Z1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">S1</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y1</span><span class="o">*</span><span class="n">Z2</span><span class="o">*</span><span class="n">Z2Z2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">S2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">Y2</span><span class="o">*</span><span class="n">Z1</span><span class="o">*</span><span class="n">Z1Z1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">H</span>    <span class="o">=</span> <span class="p">(</span><span class="n">U2</span><span class="o">-</span><span class="n">U1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">I</span>    <span class="o">=</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">H</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">H</span><span class="p">))</span><span class="o">%</span><span class="n">q</span>
        <span class="n">J</span>    <span class="o">=</span> <span class="p">(</span><span class="n">H</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">r</span>    <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">S2</span><span class="o">-</span><span class="n">S1</span><span class="p">))</span><span class="o">%</span><span class="n">q</span>
        <span class="n">V</span>    <span class="o">=</span> <span class="p">(</span><span class="n">U1</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">X3</span>   <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">r</span><span class="o">-</span><span class="n">J</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">V</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Y3</span>   <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="p">(</span><span class="n">V</span><span class="o">-</span><span class="n">X3</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">S1</span><span class="o">*</span><span class="n">J</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Z3</span>   <span class="o">=</span> <span class="p">(((</span><span class="n">Z1</span><span class="o">+</span><span class="n">Z2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">Z1</span><span class="o">+</span><span class="n">Z2</span><span class="p">)</span><span class="o">-</span><span class="n">Z1Z1</span><span class="o">-</span><span class="n">Z2Z2</span><span class="p">)</span><span class="o">*</span><span class="n">H</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="n">X3</span><span class="p">,</span><span class="n">Y3</span><span class="p">,</span><span class="n">Z3</span></div>


<div class="viewcode-block" id="TwistedEdwardCurve"><a class="viewcode-back" href="../../index.html#ecpy.curves.TwistedEdwardCurve">[docs]</a><span class="k">class</span> <span class="nc">TwistedEdwardCurve</span><span class="p">(</span><span class="n">Curve</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An elliptic curve defined by the equation: a*x²+y²=1+d*x²*y²</span>

<span class="sd">        The given domain must be a dictionary providing the following keys/values:</span>
<span class="sd">              - name (str)         : curve unique name</span>
<span class="sd">              - size (int)         : bit size</span>
<span class="sd">              - a    (int)         : `a` equation coefficient</span>
<span class="sd">              - d    (int)         : `b` equation coefficient</span>
<span class="sd">              - field (inf)        : field value</span>
<span class="sd">              - generator (int[2]) : x,y coordinate of generator</span>
<span class="sd">              - order (int)        : order of generator</span>

<span class="sd">        *Note*: you should not use the constructor and only use :func:`Curve.get_curve`</span>
<span class="sd">        builder to ensure using supported curve.</span>

<span class="sd">        Args:</span>
<span class="sd">           domain (dict): a dictionary providing curve domain parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Built an new short twisted Edward curve with the provided parameters.  &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">,</span>
                              <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;generator&#39;</span><span class="p">,</span><span class="s1">&#39;order&#39;</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">_coord_size</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Ed25519&#39;</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mi">32</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;Ed448&#39;</span><span class="p">:</span>
            <span class="n">size</span> <span class="o">=</span> <span class="mi">57</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> not supported&#39;</span><span class="o">%</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span>
        <span class="k">return</span> <span class="n">size</span>


<div class="viewcode-block" id="TwistedEdwardCurve.is_on_curve"><a class="viewcode-back" href="../../index.html#ecpy.curves.TwistedEdwardCurve.is_on_curve">[docs]</a>    <span class="k">def</span> <span class="nf">is_on_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.is_on_curve` &quot;&quot;&quot;</span>
        <span class="n">q</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">x</span>     <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="n">sqx</span>   <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">y</span>     <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">y</span>
        <span class="n">sqy</span>   <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">left</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">sqx</span><span class="o">+</span><span class="n">sqy</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">*</span><span class="n">sqx</span><span class="o">*</span><span class="n">sqy</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span></div>

<div class="viewcode-block" id="TwistedEdwardCurve.x_recover"><a class="viewcode-back" href="../../index.html#ecpy.curves.TwistedEdwardCurve.x_recover">[docs]</a>    <span class="k">def</span> <span class="nf">x_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Retrieves the x coordinate according to the y one, \</span>
<span class="sd">            such that point (x,y) is on curve.</span>

<span class="sd">        Args:</span>
<span class="sd">            y (int): y coordinate</span>
<span class="sd">            sign (int): sign of x</span>

<span class="sd">        Returns:</span>
<span class="sd">           int: the computed x coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span>
        <span class="k">if</span> <span class="n">sign</span><span class="p">:</span>
            <span class="n">sign</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># #x2 = (y^2-1) * (d*y^2-a)^-1</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">yy</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">v</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">d</span><span class="o">*</span><span class="n">yy</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span><span class="s1">&#39;Ed25519&#39;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">xx</span><span class="p">,(</span><span class="n">q</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span><span class="o">//</span><span class="mi">8</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="n">xx</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">I</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,(</span><span class="n">q</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">I</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span><span class="s1">&#39;Ed448&#39;</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">xx</span><span class="p">,(</span><span class="n">q</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> not supported&#39;</span><span class="o">%</span><span class="n">curve</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">&amp;</span><span class="mi">1</span> <span class="o">!=</span> <span class="n">sign</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">q</span><span class="o">-</span><span class="n">x</span>

        <span class="k">assert</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="n">q</span> <span class="o">==</span> <span class="n">xx</span>


        <span class="c1"># over F(q):</span>
        <span class="c1">#     a.xx +yy = 1+d.xx.yy</span>
        <span class="c1"># &lt;=&gt; xx(a-d.yy) = 1-yy</span>
        <span class="c1"># &lt;=&gt; xx = (1-yy)/(a-d.yy)</span>
        <span class="c1"># &lt;=&gt; x = +- sqrt((1-yy)/(a-d.yy))</span>
        <span class="c1"># yy   = (y*y)%q</span>
        <span class="c1"># u    = (1-yy)%q</span>
        <span class="c1"># v    = (a - d*yy)%q</span>
        <span class="c1"># v_1 = pow(v, q-2,q)</span>
        <span class="c1"># xx = (v_1*u)%q</span>
        <span class="c1"># x = self._sqrt(xx,q,sign) # Inherited generic Tonelli–Shanks from Curve</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="TwistedEdwardCurve.encode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.TwistedEdwardCurve.encode_point">[docs]</a>    <span class="k">def</span> <span class="nf">encode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Encodes a point P according to *draft_irtf-cfrg-eddsa-04*.</span>

<span class="sd">        Args:</span>
<span class="sd">            P: point to encode</span>

<span class="sd">        Returns:</span>
<span class="sd">           bytes : encoded point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coord_size</span><span class="p">()</span>

        <span class="n">y</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="s1">&#39;little&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="mh">0x80</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">y</span><span class="p">)</span></div>
<div class="viewcode-block" id="TwistedEdwardCurve.decode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.TwistedEdwardCurve.decode_point">[docs]</a>    <span class="k">def</span> <span class="nf">decode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eP</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Decodes a point P according to *draft_irtf-cfrg-eddsa-04*.</span>

<span class="sd">        Args:</span>
<span class="sd">            eP (bytes)    : encoded point</span>
<span class="sd">            curve (Curve) : curve on witch point is</span>
<span class="sd">        Returns:</span>
<span class="sd">           Point : decoded point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">y</span>    <span class="o">=</span>  <span class="nb">bytearray</span><span class="p">(</span><span class="n">eP</span><span class="p">)</span>
        <span class="n">sign</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;</span> <span class="mh">0x80</span>
        <span class="n">y</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x80</span>
        <span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="s1">&#39;little&#39;</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_recover</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">sign</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TwistedEdwardCurve.decode_scalar_25519"><a class="viewcode-back" href="../../index.html#ecpy.curves.TwistedEdwardCurve.decode_scalar_25519">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">decode_scalar_25519</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; decode scalar according to RF7748 and draft-irtf-cfrg-eddsa</span>

<span class="sd">        Args:</span>
<span class="sd">               k (bytes) : scalar to decode</span>

<span class="sd">        Returns:</span>
<span class="sd">              int: decoded scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">&amp;=</span> <span class="mh">0xF8</span>
        <span class="n">k</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">&amp;</span><span class="mh">0x7F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x40</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s1">&#39;little&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span></div>

<div class="viewcode-block" id="TwistedEdwardCurve.encode_scalar_25519"><a class="viewcode-back" href="../../index.html#ecpy.curves.TwistedEdwardCurve.encode_scalar_25519">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">encode_scalar_25519</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; encode scalar according to RF7748 and draft-irtf-cfrg-eddsa</span>

<span class="sd">        Args:</span>
<span class="sd">               k (int) : scalar to encode</span>

<span class="sd">        Returns:</span>
<span class="sd">              bytes: encoded scalar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">k</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="s1">&#39;little&#39;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">&amp;=</span> <span class="mh">0xF8</span>
        <span class="n">k</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">31</span><span class="p">]</span> <span class="o">&amp;</span><span class="mh">0x7F</span><span class="p">)</span> <span class="o">|</span> <span class="mh">0x40</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span></div>

    <span class="k">def</span> <span class="nf">_add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.add_point` &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">Q</span><span class="p">):</span>
            <span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span><span class="p">,</span><span class="n">Pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2ext</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_ext</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span><span class="p">,</span><span class="n">Pt</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span><span class="p">,</span><span class="n">Pt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2ext</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">Qx</span><span class="p">,</span><span class="n">Qy</span><span class="p">,</span><span class="n">Qz</span><span class="p">,</span><span class="n">Qt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2ext</span><span class="p">(</span><span class="n">Q</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">Q</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_ext</span><span class="p">(</span><span class="n">Px</span><span class="p">,</span><span class="n">Py</span><span class="p">,</span><span class="n">Pz</span><span class="p">,</span><span class="n">Pt</span><span class="p">,</span> <span class="n">Qx</span><span class="p">,</span><span class="n">Qy</span><span class="p">,</span><span class="n">Qz</span><span class="p">,</span><span class="n">Qt</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">z</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext2aff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_infinity_point</span>

    <span class="k">def</span> <span class="nf">_mul_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.add_point` &quot;&quot;&quot;</span>
        <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aff2ext</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_ext</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sz</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;1&#39;</span> <span class="p">:</span>
                <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_ext</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_ext</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_ext</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
                <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dbl_ext</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z1</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ext2aff</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span> <span class="n">q</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_infinity_point</span>

    <span class="k">def</span> <span class="nf">_neg_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">-</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_aff2ext</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">z</span><span class="p">)</span> <span class="o">%</span> <span class="n">q</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_ext2aff</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">xy</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
        <span class="n">invz</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">q</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">q</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">invz</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">*</span><span class="n">invz</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_dbl_ext</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">Y1</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span><span class="n">XY1</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
        <span class="n">A</span>  <span class="o">=</span> <span class="p">(</span><span class="n">X1</span><span class="o">*</span><span class="n">X1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">B</span>  <span class="o">=</span> <span class="p">(</span><span class="n">Y1</span><span class="o">*</span><span class="n">Y1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">C</span>  <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Z1</span><span class="o">*</span><span class="n">Z1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">D</span>  <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">A</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">E</span>  <span class="o">=</span> <span class="p">((</span><span class="n">X1</span><span class="o">+</span><span class="n">Y1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">X1</span><span class="o">+</span><span class="n">Y1</span><span class="p">)</span><span class="o">-</span><span class="n">A</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">G</span>  <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">F</span>  <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">H</span>  <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">X3</span>  <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">F</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Y3</span>  <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">H</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">XY3</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">H</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Z3</span>  <span class="o">=</span> <span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="n">G</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">X3</span><span class="p">,</span><span class="n">Y3</span><span class="p">,</span><span class="n">Z3</span><span class="p">,</span><span class="n">XY3</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_add_ext</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span><span class="n">Y1</span><span class="p">,</span><span class="n">Z1</span><span class="p">,</span><span class="n">XY1</span><span class="p">,</span>  <span class="n">X2</span><span class="p">,</span><span class="n">Y2</span><span class="p">,</span><span class="n">Z2</span><span class="p">,</span><span class="n">XY2</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span><span class="n">a</span><span class="p">):</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">X1</span><span class="o">*</span><span class="n">X2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">B</span> <span class="o">=</span> <span class="p">(</span><span class="n">Y1</span><span class="o">*</span><span class="n">Y2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">Z1</span><span class="o">*</span><span class="n">XY2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">D</span> <span class="o">=</span> <span class="p">(</span><span class="n">XY1</span><span class="o">*</span><span class="n">Z2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">E</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">+</span><span class="n">C</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="p">(</span><span class="n">X1</span><span class="o">-</span><span class="n">Y1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="p">(</span><span class="n">X2</span><span class="o">+</span><span class="n">Y2</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="p">(</span><span class="n">t0</span><span class="o">*</span><span class="n">t1</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span><span class="o">+</span><span class="n">B</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="n">t3</span><span class="o">-</span><span class="n">A</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">t4</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">A</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">G</span> <span class="o">=</span> <span class="p">(</span><span class="n">B</span><span class="o">+</span><span class="n">t4</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="n">D</span><span class="o">-</span><span class="n">C</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">X3</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">F</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Y3</span> <span class="o">=</span> <span class="p">(</span><span class="n">G</span><span class="o">*</span><span class="n">H</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">XY3</span> <span class="o">=</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">H</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="n">Z3</span> <span class="o">=</span> <span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="n">G</span><span class="p">)</span><span class="o">%</span><span class="n">q</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">X3</span><span class="p">,</span><span class="n">Y3</span><span class="p">,</span><span class="n">Z3</span><span class="p">,</span><span class="n">XY3</span><span class="p">)</span></div>


<div class="viewcode-block" id="MontgomeryCurve"><a class="viewcode-back" href="../../index.html#ecpy.curves.MontgomeryCurve">[docs]</a><span class="k">class</span> <span class="nc">MontgomeryCurve</span><span class="p">(</span><span class="n">Curve</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;An elliptic curve defined by the equation: b.y²=x³+a*x²+x.</span>

<span class="sd">        The given domain must be a dictionary providing the following keys/values:</span>
<span class="sd">              - name (str)         : curve unique name</span>
<span class="sd">              - size (int)         : bit size</span>
<span class="sd">              - a    (int)         : `a` equation coefficient</span>
<span class="sd">              - b    (int)         : `b` equation coefficient</span>
<span class="sd">              - field (inf)        : field value</span>
<span class="sd">              - generator (int[2]) : x,y coordinate of generator</span>
<span class="sd">              - order (int)        : order of generator</span>

<span class="sd">        *Note*: you should not use the constructor and only use :func:`Curve.get_curve`</span>
<span class="sd">        builder to ensure using supported curve.</span>

<span class="sd">        Args:</span>
<span class="sd">           domain (dict): a dictionary providing curve domain parameters</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Built an new short twisted Edward curve with the provided parameters.  &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_domain</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;type&#39;</span><span class="p">,</span><span class="s1">&#39;size&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;field&#39;</span><span class="p">,</span><span class="s1">&#39;generator&#39;</span><span class="p">,</span><span class="s1">&#39;order&#39;</span><span class="p">))</span>
        <span class="c1">#inv4 = pow(4,p-2,p)</span>
        <span class="c1">#self.a24  = ((self.a+2)*inv4)%p</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">a24</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span><span class="o">//</span><span class="mi">4</span>

<div class="viewcode-block" id="MontgomeryCurve.is_on_curve"><a class="viewcode-back" href="../../index.html#ecpy.curves.MontgomeryCurve.is_on_curve">[docs]</a>    <span class="k">def</span> <span class="nf">is_on_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.is_on_curve` &quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
        <span class="k">if</span> <span class="n">P</span><span class="o">.</span><span class="n">has_y</span><span class="p">:</span>
            <span class="n">y</span>     <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">y</span>
            <span class="n">left</span>  <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">y</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
            <span class="k">return</span> <span class="n">left</span> <span class="o">==</span> <span class="n">right</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#check equation has a solution according to Euler criterion</span>
            <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">right</span><span class="p">,(</span><span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="MontgomeryCurve.y_recover"><a class="viewcode-back" href="../../index.html#ecpy.curves.MontgomeryCurve.y_recover">[docs]</a>    <span class="k">def</span> <span class="nf">y_recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">sign</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; &quot;&quot;&quot;</span>
        <span class="n">p</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="n">by2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
        <span class="n">binv</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">((</span><span class="n">binv</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">)</span><span class="o">%</span><span class="n">p</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="n">binv</span><span class="o">*</span><span class="n">by2</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
        <span class="n">y</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqrt</span><span class="p">(</span><span class="n">y2</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">sign</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y</span></div>

<div class="viewcode-block" id="MontgomeryCurve.encode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.MontgomeryCurve.encode_point">[docs]</a>    <span class="k">def</span> <span class="nf">encode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Encodes a point P according to *RFC7748*.</span>

<span class="sd">        Args:</span>
<span class="sd">            P: point to encode</span>

<span class="sd">        Returns:</span>
<span class="sd">           bytes : encoded point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="o">&gt;&gt;</span><span class="mi">3</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">to_bytes</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="s1">&#39;little&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="MontgomeryCurve.decode_point"><a class="viewcode-back" href="../../index.html#ecpy.curves.MontgomeryCurve.decode_point">[docs]</a>    <span class="k">def</span> <span class="nf">decode_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eP</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Decodes a point P according to *RFC7748*.</span>

<span class="sd">        Args:</span>
<span class="sd">            eP (bytes)    : encoded point</span>
<span class="sd">            curve (Curve) : curve on witch point is</span>
<span class="sd">        Returns:</span>
<span class="sd">           Point : decoded point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span>    <span class="o">=</span>  <span class="nb">bytearray</span><span class="p">(</span><span class="n">eP</span><span class="p">)</span>
        <span class="n">x</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="mh">0x80</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;little&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; See :func:`Curve.add_point` &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">Q</span><span class="o">.</span><span class="n">has_y</span> <span class="ow">and</span> <span class="n">P</span> <span class="o">==</span> <span class="o">-</span><span class="n">Q</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_infinity_point</span>

        <span class="k">if</span> <span class="n">P</span> <span class="o">==</span> <span class="n">Q</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mul_point</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">P</span><span class="p">)</span>

        <span class="n">x1</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">y</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">Q</span><span class="o">.</span><span class="n">x</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="n">Q</span><span class="o">.</span><span class="n">y</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">x2</span><span class="o">!=</span><span class="n">x1</span><span class="p">)</span>

        <span class="n">invx2x1</span>   <span class="o">=</span> <span class="nb">pow</span><span class="p">(((</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">))</span>                <span class="o">%</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">invx2x1_2</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(((</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">))</span>        <span class="o">%</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">invx2x1_3</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(((</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">))</span><span class="o">%</span><span class="n">p</span><span class="p">,</span> <span class="n">p</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

        <span class="c1">#x3 =</span>
        <span class="c1">#      b*(y2-y1)²    /(x2-x1)²       -a-x1-x2</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">invx2x1_2</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">-</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span> <span class="p">)</span> <span class="o">%</span><span class="n">p</span>
        <span class="c1"># y3 =</span>
        <span class="c1">#      (2*x1+x2+a)*(y2-y1)/(x2-x1)      - b*(y2-y1)³         /(x2-x1)³  -y1</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">x1</span><span class="o">+</span><span class="n">x2</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">)</span><span class="o">*</span><span class="n">invx2x1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="nb">pow</span><span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">invx2x1_3</span> <span class="o">-</span><span class="n">y1</span> <span class="p">)</span> <span class="o">%</span><span class="n">p</span>

        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span><span class="n">y3</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_mul_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  &quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="nb">bin</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">sz</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">x3</span> <span class="o">=</span> <span class="n">P</span><span class="o">.</span><span class="n">x</span>
        <span class="n">z3</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">sz</span><span class="p">):</span>
            <span class="n">ki</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ki</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">x3</span><span class="p">,</span><span class="n">z3</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ladder_step</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span><span class="n">z3</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">z2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span><span class="n">z3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ladder_step</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span><span class="n">z3</span><span class="p">)</span>

        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>
        <span class="k">if</span> <span class="n">z2</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">has_y</span><span class="p">):</span>
                <span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ladder_recover_y</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span><span class="n">z2</span><span class="p">,</span> <span class="n">x3</span><span class="p">,</span><span class="n">z3</span><span class="p">)</span>
            <span class="n">zinv</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">z2</span><span class="p">,(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>
            <span class="n">kx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x2</span><span class="o">*</span><span class="n">zinv</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
            <span class="n">ky</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">y2</span><span class="p">:</span>
                <span class="n">ky</span> <span class="o">=</span> <span class="p">(</span><span class="n">y2</span><span class="o">*</span><span class="n">zinv</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>
            <span class="k">return</span> <span class="n">Point</span> <span class="p">(</span><span class="n">kx</span><span class="p">,</span> <span class="n">ky</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_infinity_point</span>

    <span class="k">def</span> <span class="nf">_neg_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Point</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">field</span><span class="o">-</span><span class="n">P</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ladder_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x_qp</span><span class="p">,</span> <span class="n">x_p</span><span class="p">,</span> <span class="n">z_p</span><span class="p">,</span> <span class="n">x_q</span><span class="p">,</span> <span class="n">z_q</span><span class="p">):</span>
        <span class="n">p</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>

        <span class="n">t1</span>   <span class="o">=</span> <span class="p">(</span><span class="n">x_p</span> <span class="o">+</span> <span class="n">z_p</span><span class="p">)</span>              <span class="o">%</span><span class="n">p</span>
        <span class="n">t6</span>   <span class="o">=</span> <span class="p">(</span><span class="n">t1</span>  <span class="o">*</span> <span class="n">t1</span><span class="p">)</span>               <span class="o">%</span><span class="n">p</span>
        <span class="n">t2</span>   <span class="o">=</span> <span class="p">(</span><span class="n">x_p</span> <span class="o">-</span> <span class="n">z_p</span><span class="p">)</span>              <span class="o">%</span><span class="n">p</span>
        <span class="n">t7</span>   <span class="o">=</span> <span class="p">(</span><span class="n">t2</span>  <span class="o">*</span> <span class="n">t2</span><span class="p">)</span>               <span class="o">%</span><span class="n">p</span>
        <span class="n">t5</span>   <span class="o">=</span> <span class="p">(</span><span class="n">t6</span>  <span class="o">-</span> <span class="n">t7</span><span class="p">)</span>               <span class="o">%</span><span class="n">p</span>
        <span class="n">t3</span>   <span class="o">=</span> <span class="p">(</span><span class="n">x_q</span> <span class="o">+</span> <span class="n">z_q</span><span class="p">)</span>              <span class="o">%</span><span class="n">p</span>
        <span class="n">t4</span>   <span class="o">=</span> <span class="p">(</span><span class="n">x_q</span> <span class="o">-</span> <span class="n">z_q</span><span class="p">)</span>              <span class="o">%</span><span class="n">p</span>
        <span class="n">t8</span>   <span class="o">=</span> <span class="p">(</span><span class="n">t4</span>  <span class="o">*</span> <span class="n">t1</span><span class="p">)</span>               <span class="o">%</span><span class="n">p</span>
        <span class="n">t9</span>   <span class="o">=</span> <span class="p">(</span><span class="n">t3</span>  <span class="o">*</span> <span class="n">t2</span><span class="p">)</span>               <span class="o">%</span><span class="n">p</span>

        <span class="n">x_pq</span> <span class="o">=</span> <span class="p">((</span><span class="n">t8</span><span class="o">+</span><span class="n">t9</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t8</span><span class="o">+</span><span class="n">t9</span><span class="p">))</span>        <span class="o">%</span><span class="n">p</span>
        <span class="n">z_pq</span> <span class="o">=</span> <span class="p">(</span><span class="n">x_qp</span><span class="o">*</span><span class="p">(</span><span class="n">t8</span><span class="o">-</span><span class="n">t9</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">t8</span><span class="o">-</span><span class="n">t9</span><span class="p">))</span>   <span class="o">%</span><span class="n">p</span>
        <span class="n">x_2p</span> <span class="o">=</span> <span class="p">(</span><span class="n">t6</span><span class="o">*</span><span class="n">t7</span><span class="p">)</span><span class="o">%</span><span class="n">p</span>                <span class="o">%</span><span class="n">p</span>
        <span class="n">z_2p</span> <span class="o">=</span> <span class="p">(</span><span class="n">t5</span><span class="o">*</span><span class="p">(</span><span class="n">t7</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">a24</span><span class="o">*</span><span class="n">t5</span><span class="p">))</span>    <span class="o">%</span><span class="n">p</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">x_2p</span><span class="p">,</span> <span class="n">z_2p</span><span class="p">,</span> <span class="n">x_pq</span><span class="p">,</span> <span class="n">z_pq</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ladder_recover_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xp</span><span class="p">,</span><span class="n">yp</span><span class="p">,</span> <span class="n">xq</span><span class="p">,</span><span class="n">zq</span><span class="p">,</span> <span class="n">xa</span><span class="p">,</span> <span class="n">za</span><span class="p">):</span>
        <span class="n">p</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field</span>

        <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">xp</span><span class="o">*</span><span class="n">zq</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">xq</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">xq</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">*</span><span class="n">v3</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="p">(</span><span class="n">v3</span><span class="o">*</span><span class="n">xa</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">*</span><span class="n">zq</span><span class="p">)</span>   <span class="o">%</span><span class="n">p</span>

        <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">+</span><span class="n">v1</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">xp</span><span class="o">*</span><span class="n">xq</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v4</span> <span class="o">=</span> <span class="p">(</span><span class="n">v4</span><span class="o">+</span><span class="n">zq</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">*</span><span class="n">v4</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="n">zq</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v1</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">*</span><span class="n">za</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>

        <span class="n">y</span>  <span class="o">=</span> <span class="p">(</span><span class="n">v2</span><span class="o">-</span><span class="n">v3</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="o">*</span><span class="n">yp</span><span class="p">)</span>   <span class="o">%</span><span class="n">p</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="n">zq</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="n">za</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">x</span>  <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="n">xq</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>
        <span class="n">z</span>  <span class="o">=</span> <span class="p">(</span><span class="n">v1</span><span class="o">*</span><span class="n">zq</span><span class="p">)</span>         <span class="o">%</span><span class="n">p</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span></div>

<div class="viewcode-block" id="Point"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point">[docs]</a><span class="k">class</span> <span class="nc">Point</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Immutable Elliptic Curve Point.</span>

<span class="sd">    A Point support the following operator:</span>

<span class="sd">        - `-` : Point Subtraction.</span>
<span class="sd">        - `+` : Point Addition, with automatic doubling support.</span>
<span class="sd">        - `*` : Scalar multiplication, can write as k*P or P*k, with P :class:Point and  k :class:int.</span>
<span class="sd">        - `==`: Point comparison.</span>
<span class="sd">        - `-` : Point negation (unary operator).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        x (int)       : Affine x coordinate</span>
<span class="sd">        y (int)       : Affine y coordinate</span>
<span class="sd">        curve (Curve) : Curve on which the point is define</span>
<span class="sd">        check(bool)   : Check or not if the built point is on curve</span>

<span class="sd">    Args:</span>
<span class="sd">        x (int) :     x coordinate</span>
<span class="sd">        y (int) :     y coordinate</span>
<span class="sd">        check (bool): if True enforce x,y is on curve</span>

<span class="sd">    Raises:</span>
<span class="sd">        ECPyException : if check=True and x,y is not on curve</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="vm">__slots__</span> <span class="o">=</span> <span class="s1">&#39;_x&#39;</span><span class="p">,</span> <span class="s1">&#39;_y&#39;</span><span class="p">,</span> <span class="s1">&#39;_curve&#39;</span><span class="p">,</span> <span class="s1">&#39;_at_infinity&#39;</span>

<div class="viewcode-block" id="Point.infinity"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point.infinity">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">infinity</span><span class="p">():</span>
        <span class="sd">&quot;&quot;&quot; Return the unique (singleton) point at infinity</span>

<span class="sd">        Returns:</span>
<span class="sd">                Point : infinity Point</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">_infinity_point</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span> <span class="n">curve</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_at_infinity</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span> <span class="o">=</span> <span class="n">curve</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">check</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">curve</span><span class="o">.</span><span class="n">is_on_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s2">&quot;Point not on curve&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_infinity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tell is this pointn is the inifinity one</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: true if self is infinity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_at_infinity</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; X affine coordinate of this point</span>

<span class="sd">            Returns:</span>
<span class="sd">                x coordinate</span>

<span class="sd">            Raises:</span>
<span class="sd">                ECPyException: if point is infinity</span>
<span class="sd">                ECPyException: if point has no x coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;Infinity&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;x coordinate not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Y affine coordinate of this point</span>

<span class="sd">            Returns:</span>
<span class="sd">                x coordinate</span>

<span class="sd">            Raises:</span>
<span class="sd">                ECPyException: if point is infinity</span>
<span class="sd">                ECPyException: if point has no y coordinate</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;Infinity&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;y coordinate not set&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_x</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tell if this point has y coordinate</span>

<span class="sd">            Returns:</span>
<span class="sd">                Trueu if x coordinate is set, False else</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">!=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_y</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tell if this point has y coordinate</span>

<span class="sd">            Returns:</span>
<span class="sd">                Trueu if y coordinate is set, False else</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">!=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">curve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returned the curve on which this point is defined</span>

<span class="sd">            Returns:</span>
<span class="sd">                Curve: this point curve</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_on_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;&quot; Tells if this point is on the curve</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool: True if point on curve, False else</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">is_on_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Point.recover"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point.recover">[docs]</a>    <span class="k">def</span> <span class="nf">recover</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sign</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Recvoer the missing corrdinate according to the know one and the provided sign of the missing one</span>

<span class="sd">            Args:</span>
<span class="sd">                sign (int): zero or one</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">y_recover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">x_recover</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">,</span> <span class="n">sign</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">Point</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">Q</span><span class="o">.</span><span class="n">_curve</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;__add__: points on same curve&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Q</span>
            <span class="k">if</span> <span class="n">Q</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">_add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Q</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;__add__: type not supported: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">Point</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="n">Q</span><span class="o">.</span><span class="n">_curve</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;__sub__: points on same curve&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
                <span class="k">return</span> <span class="o">-</span><span class="n">Q</span>
            <span class="k">if</span> <span class="n">Q</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">_add_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">-</span><span class="n">Q</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;__sub__: type not supported: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">Q</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scal</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scal</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span>
            <span class="k">if</span> <span class="n">scal</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">order</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">Point</span><span class="o">.</span><span class="n">infinity</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">_mul_point</span><span class="p">(</span><span class="n">scal</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">ECPyException</span><span class="p">(</span><span class="s1">&#39;__mul__: type not supported: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">type</span><span class="p">(</span><span class="n">scal</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">scal</span><span class="p">)</span> <span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="n">scal</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">curve</span><span class="o">.</span><span class="n">_neg_point</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Q</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">Point</span><span class="p">)</span> <span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span> <span class="ow">and</span> <span class="n">Q</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span> <span class="ow">or</span> <span class="n">Q</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curve</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">Q</span><span class="o">.</span><span class="n">_curve</span><span class="o">.</span><span class="n">name</span>  <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_x</span> <span class="o">==</span> <span class="n">Q</span><span class="o">.</span><span class="n">_x</span> <span class="ow">and</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_y</span> <span class="o">==</span> <span class="n">Q</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;eq: type not supported: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Q</span><span class="p">)))</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_infinity</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;inf&quot;</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_x</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_y</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;(0x</span><span class="si">%x</span><span class="s2"> , 0x</span><span class="si">%x</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_x</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;(0x</span><span class="si">%x</span><span class="s2"> , .)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_y</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;(. , 0x</span><span class="si">%x</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;(. , .)&quot;</span>

<div class="viewcode-block" id="Point.add"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point.add">[docs]</a>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the addition of self and provided point.</span>

<span class="sd">            Args:</span>
<span class="sd">                Q(Point): Point to add</span>

<span class="sd">            Returns:</span>
<span class="sd">                Point: self+Q</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span></div>

<div class="viewcode-block" id="Point.sub"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point.sub">[docs]</a>    <span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the subtraction of felf and provided point.</span>

<span class="sd">            Args:</span>
<span class="sd">                Q(Point): Point to subtract</span>

<span class="sd">            Returns:</span>
<span class="sd">                Point: self-Q</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__sub__</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span></div>

<div class="viewcode-block" id="Point.mul"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point.mul">[docs]</a>    <span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the scalar multiplication of self by k</span>

<span class="sd">            Args:</span>
<span class="sd">                k(int): the scalar to multiply</span>

<span class="sd">            Returns:</span>
<span class="sd">                Point: k*self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span></div>

<div class="viewcode-block" id="Point.neg"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point.neg">[docs]</a>    <span class="k">def</span> <span class="nf">neg</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return the opposite self point bycallinf Curve.neg function</span>

<span class="sd">            Returns:</span>
<span class="sd">                Point: -self</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__neg__</span><span class="p">()</span></div>

<div class="viewcode-block" id="Point.eq"><a class="viewcode-back" href="../../index.html#ecpy.curves.Point.eq">[docs]</a>    <span class="k">def</span> <span class="nf">eq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Q</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Tells is the provided Point and this point have the same coordinate.</span>

<span class="sd">            Args:</span>
<span class="sd">                Q(Point): Point to check the equality</span>

<span class="sd">            Returns:</span>
<span class="sd">                bool: True if P==Q, False else.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__eq__</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span></div></div>

<span class="n">_infinity_point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">False</span><span class="p">)</span>
<span class="n">_infinity_point</span><span class="o">.</span><span class="n">_at_infinity</span> <span class="o">=</span> <span class="kc">True</span>


<div class="viewcode-block" id="ECPyException"><a class="viewcode-back" href="../../index.html#ecpy.curves.ECPyException">[docs]</a><span class="k">class</span> <span class="nc">ECPyException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">rept</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span></div>







<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1">###############################</span>
        <span class="c1">### Weierstrass quick check ###</span>
        <span class="c1">###############################</span>
        <span class="n">cv</span>  <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">get_curve</span><span class="p">(</span><span class="s1">&#39;secp256k1&#39;</span><span class="p">)</span>

        <span class="c1">#check generator</span>
        <span class="n">Gx</span> <span class="o">=</span> <span class="mh">0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798</span>
        <span class="n">Gy</span> <span class="o">=</span> <span class="mh">0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">Gx</span><span class="p">,</span> <span class="n">Gy</span><span class="p">,</span> <span class="n">cv</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">G</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">generator</span><span class="p">)</span>

        <span class="c1">#define point</span>
        <span class="n">W1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x6fb13b7e8ab1c7d191d16197c1bf7f8dc7992412e1266155b3fb3ac8b30f3ed8</span><span class="p">,</span>
                   <span class="mh">0x2e1eb77bd89505113819600b395e0475d102c4788a3280a583d9d82625ed8533</span><span class="p">,</span>
                   <span class="n">cv</span><span class="p">)</span>
        <span class="n">W2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x07cd9ee748a0b26773d9d29361f75594964106d13e1cad67cfe2df503ee3e90e</span><span class="p">,</span>
                   <span class="mh">0xd209f7c16cdb6d3559bea88c7d920f8ff077406c615da8adfecdeef604cb40a6</span><span class="p">,</span>
                   <span class="n">cv</span><span class="p">)</span>

        <span class="c1">#check add</span>
        <span class="n">sum_W1_W2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0xc4a20cbc2dc27c70fbc1335292c109a1ccd106981b5698feafe702bcb0fb2fca</span><span class="p">,</span>
                          <span class="mh">0x7e1ad514051b87b7ce815c7defcd4fcc01e88842b3135e10a342be49bf5cad09</span><span class="p">,</span>
                          <span class="n">cv</span><span class="p">)</span>
        <span class="n">dbl_W2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0xb4f211b11166e6b3a3561e5978f47855787943dbeccd2014706c941a5890c913</span><span class="p">,</span>
                       <span class="mh">0xe0122dc6f3ce097eb73865e66a1ced02a518afdec02596d7d152f121391e2d63</span><span class="p">,</span>
                       <span class="n">cv</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">W1</span><span class="o">+</span><span class="n">W2</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="n">sum_W1_W2</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">W2</span><span class="o">+</span><span class="n">W2</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">dbl_W2</span><span class="p">)</span>

        <span class="c1">#check mul</span>
        <span class="n">k</span> <span class="o">=</span> <span class="mh">0x2976F786AE6333E125C0DFFD6C16D37E8CED5ABEDB491BCCA21C75B307D0B318</span>
        <span class="n">kW1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x1de93c28f8c58db95f30be1704394f6f5d4602291c4933a1126cc61f9ed70b88</span><span class="p">,</span>
                    <span class="mh">0x6f66df7bb6b37609cacded3052e1d127b47684949dff366020f824d517d66f34</span><span class="p">,</span>
                    <span class="n">cv</span><span class="p">)</span>
        <span class="n">mulW1</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">W1</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">kW1</span> <span class="o">==</span> <span class="n">mulW1</span><span class="p">)</span>

        <span class="c1">#check encoding</span>
        <span class="n">W2_enc</span> <span class="o">=</span> <span class="p">[</span> <span class="mh">0x04</span><span class="p">,</span>
                   <span class="c1">#x</span>
                   <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">,</span> <span class="mh">0xd2</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span>
                   <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span>
                <span class="c1">#y</span>
                   <span class="mh">0xd2</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0xc1</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0x6d</span><span class="p">,</span> <span class="mh">0x35</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0xbe</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0x8c</span><span class="p">,</span> <span class="mh">0x7d</span><span class="p">,</span> <span class="mh">0x92</span><span class="p">,</span> <span class="mh">0x0f</span><span class="p">,</span> <span class="mh">0x8f</span><span class="p">,</span>
                   <span class="mh">0xf0</span><span class="p">,</span> <span class="mh">0x77</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0x5d</span><span class="p">,</span> <span class="mh">0xa8</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0xfe</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0xee</span><span class="p">,</span> <span class="mh">0xf6</span><span class="p">,</span> <span class="mh">0x04</span><span class="p">,</span> <span class="mh">0xcb</span><span class="p">,</span> <span class="mh">0x40</span><span class="p">,</span> <span class="mh">0xa6</span><span class="p">]</span>
        <span class="n">dW2_enc</span> <span class="o">=</span> <span class="p">[</span> <span class="mh">0x04</span><span class="p">,</span>
                    <span class="c1">#x</span>
                    <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span>
                    <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span>
                    <span class="c1">#y</span>
                    <span class="mh">0xe0</span><span class="p">,</span> <span class="mh">0x12</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0xc6</span><span class="p">,</span> <span class="mh">0xf3</span><span class="p">,</span> <span class="mh">0xce</span><span class="p">,</span> <span class="mh">0x09</span><span class="p">,</span> <span class="mh">0x7e</span><span class="p">,</span> <span class="mh">0xb7</span><span class="p">,</span> <span class="mh">0x38</span><span class="p">,</span> <span class="mh">0x65</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0x6a</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xed</span><span class="p">,</span> <span class="mh">0x02</span><span class="p">,</span>
                <span class="mh">0xa5</span><span class="p">,</span> <span class="mh">0x18</span><span class="p">,</span> <span class="mh">0xaf</span><span class="p">,</span> <span class="mh">0xde</span><span class="p">,</span> <span class="mh">0xc0</span><span class="p">,</span> <span class="mh">0x25</span><span class="p">,</span> <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0xd7</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x52</span><span class="p">,</span> <span class="mh">0xf1</span><span class="p">,</span> <span class="mh">0x21</span><span class="p">,</span> <span class="mh">0x39</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x2d</span><span class="p">,</span> <span class="mh">0x63</span><span class="p">]</span>
        <span class="n">W2_enc_comp</span> <span class="o">=</span> <span class="p">[</span> <span class="mh">0x02</span><span class="p">,</span>
                        <span class="c1">#x</span>
                        <span class="mh">0x07</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x9e</span><span class="p">,</span> <span class="mh">0xe7</span><span class="p">,</span> <span class="mh">0x48</span><span class="p">,</span> <span class="mh">0xa0</span><span class="p">,</span> <span class="mh">0xb2</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0x73</span><span class="p">,</span> <span class="mh">0xd9</span><span class="p">,</span> <span class="mh">0xd2</span><span class="p">,</span> <span class="mh">0x93</span><span class="p">,</span> <span class="mh">0x61</span><span class="p">,</span> <span class="mh">0xf7</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span>
                        <span class="mh">0x96</span><span class="p">,</span> <span class="mh">0x41</span><span class="p">,</span> <span class="mh">0x06</span><span class="p">,</span> <span class="mh">0xd1</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0x1c</span><span class="p">,</span> <span class="mh">0xad</span><span class="p">,</span> <span class="mh">0x67</span><span class="p">,</span> <span class="mh">0xcf</span><span class="p">,</span> <span class="mh">0xe2</span><span class="p">,</span> <span class="mh">0xdf</span><span class="p">,</span> <span class="mh">0x50</span><span class="p">,</span> <span class="mh">0x3e</span><span class="p">,</span> <span class="mh">0xe3</span><span class="p">,</span> <span class="mh">0xe9</span><span class="p">,</span> <span class="mh">0x0e</span><span class="p">,</span>
                        <span class="c1">#y sign</span>
                        <span class="c1">#0</span>
                        <span class="p">]</span>
        <span class="n">dW2_enc_comp</span> <span class="o">=</span> <span class="p">[</span> <span class="mh">0x03</span><span class="p">,</span>
                        <span class="c1">#x²</span>
                         <span class="mh">0xb4</span><span class="p">,</span> <span class="mh">0xf2</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0xb1</span><span class="p">,</span> <span class="mh">0x11</span><span class="p">,</span> <span class="mh">0x66</span><span class="p">,</span> <span class="mh">0xe6</span><span class="p">,</span> <span class="mh">0xb3</span><span class="p">,</span> <span class="mh">0xa3</span><span class="p">,</span> <span class="mh">0x56</span><span class="p">,</span> <span class="mh">0x1e</span><span class="p">,</span> <span class="mh">0x59</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0xf4</span><span class="p">,</span> <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x55</span><span class="p">,</span>
                         <span class="mh">0x78</span><span class="p">,</span> <span class="mh">0x79</span><span class="p">,</span> <span class="mh">0x43</span><span class="p">,</span> <span class="mh">0xdb</span><span class="p">,</span> <span class="mh">0xec</span><span class="p">,</span> <span class="mh">0xcd</span><span class="p">,</span> <span class="mh">0x20</span><span class="p">,</span> <span class="mh">0x14</span><span class="p">,</span> <span class="mh">0x70</span><span class="p">,</span> <span class="mh">0x6c</span><span class="p">,</span> <span class="mh">0x94</span><span class="p">,</span> <span class="mh">0x1a</span><span class="p">,</span> <span class="mh">0x58</span><span class="p">,</span> <span class="mh">0x90</span><span class="p">,</span> <span class="mh">0xc9</span><span class="p">,</span> <span class="mh">0x13</span><span class="p">,</span>
                        <span class="c1">#y</span>
                        <span class="c1"># 1</span>
                        <span class="p">]</span>

        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">W2</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">W2_enc</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">W2</span><span class="p">)</span>

        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">dbl_W2</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">dW2_enc</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">dbl_W2</span><span class="p">)</span>

        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">W2</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">W2_enc_comp</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">W2</span><span class="p">)</span>

        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">dbl_W2</span><span class="p">,</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">dW2_enc_comp</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span> <span class="o">==</span> <span class="n">dbl_W2</span><span class="p">)</span>


        <span class="c1">##################################</span>
        <span class="c1">### Twisted Edward quick check ###</span>
        <span class="c1">##################################</span>
        <span class="n">cv</span>  <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">get_curve</span><span class="p">(</span><span class="s1">&#39;Ed25519&#39;</span><span class="p">)</span>

        <span class="n">W1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x36ab384c9f5a046c3d043b7d1833e7ac080d8e4515d7a45f83c5a14e2843ce0e</span><span class="p">,</span>
                   <span class="mh">0x2260cdf3092329c21da25ee8c9a21f5697390f51643851560e5f46ae6af8a3c9</span><span class="p">,</span>
                   <span class="n">cv</span><span class="p">)</span>
        <span class="n">W2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x67ae9c4a22928f491ff4ae743edac83a6343981981624886ac62485fd3f8e25c</span><span class="p">,</span>
                   <span class="mh">0x1267b1d177ee69aba126a18e60269ef79f16ec176724030402c3684878f5b4d4</span><span class="p">,</span>
                   <span class="n">cv</span><span class="p">)</span>

        <span class="c1">#check generator</span>
        <span class="n">Bx</span> <span class="o">=</span> <span class="mi">15112221349535400772501151409588531511454012693041857206046113283949847762202</span>
        <span class="n">By</span> <span class="o">=</span> <span class="mi">46316835694926478169428394003475163141307993866256225615783033603165251855960</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">Bx</span><span class="p">,</span> <span class="n">By</span><span class="p">,</span> <span class="n">cv</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">B</span> <span class="o">==</span> <span class="n">cv</span><span class="o">.</span><span class="n">generator</span><span class="p">)</span>

        <span class="c1">#check add</span>
        <span class="n">sum_W1_W2</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x49fda73eade3587bfcef7cf7d12da5de5c2819f93e1be1a591409cc0322ef233</span><span class="p">,</span>
                          <span class="mh">0x5f4825b298feae6fe02c6e148992466631282eca89430b5d10d21f83d676c8ed</span><span class="p">,</span>

                          <span class="n">cv</span><span class="p">)</span>
        <span class="n">dbl_W1</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x203da8db56cff1468325d4b87a3520f91a739ec193ce1547493aa657c4c9f870</span><span class="p">,</span>
                       <span class="mh">0x47d0e827cb1595e1470eb88580d5716c4cf22832ea2f0ff0df38ab61ca32112f</span><span class="p">,</span>
                       <span class="n">cv</span><span class="p">)</span>

        <span class="n">s</span> <span class="o">=</span> <span class="n">W1</span><span class="o">+</span><span class="n">W2</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">s</span> <span class="o">==</span> <span class="n">sum_W1_W2</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">W1</span><span class="o">+</span><span class="n">W1</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">d</span> <span class="o">==</span> <span class="n">dbl_W1</span><span class="p">)</span>

        <span class="c1">#check mul</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x74ad28205b4f384bc0813e6585864e528085f91fb6a5096f244ae01e57de43ae</span><span class="p">,</span>
                  <span class="mh">0x0c66f42af155cdc08c96c42ecf2c989cbc7e1b4da70ab7925a8943e8c317403d</span><span class="p">,</span>
                  <span class="n">cv</span><span class="p">)</span>
        <span class="n">k</span>  <span class="o">=</span> <span class="mh">0x035ce307f6524510110b4ea1c8af0e81fb705118ebcf886912f8d2d87b5776b3</span>
        <span class="n">kA</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mh">0x0d968dd46de0ff98f4a6916e60f84c8068444dbc2d93f5d3b9cf06dade04a994</span><span class="p">,</span>
                   <span class="mh">0x3ba16a015e1dd42b3d088c7a68c344ec47aaba463f67f4e9099c634f64781e00</span><span class="p">,</span>
                   <span class="n">cv</span><span class="p">)</span>
        <span class="n">mul</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">A</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">mul</span> <span class="o">==</span> <span class="n">kA</span><span class="p">)</span>


        <span class="c1">##################################</span>
        <span class="c1">### Montgomery quick check ###</span>
        <span class="c1">##################################</span>

        <span class="n">cv</span>     <span class="o">=</span> <span class="n">Curve</span><span class="o">.</span><span class="n">get_curve</span><span class="p">(</span><span class="s1">&#39;Curve25519&#39;</span><span class="p">)</span>
        <span class="n">eP</span> <span class="o">=</span>  <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;e3712d851a0e5d79b831c5e34ab22b41a198171de209b8b8faca23a11c624859&quot;</span><span class="p">)</span>
        <span class="n">_P</span>  <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">eP</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">_P</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mh">0x5948621ca123cafab8b809e21d1798a1412bb24ae3c531b8795d0e1a852d71e3</span><span class="p">)</span>
        <span class="n">_eP</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">_P</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">_eP</span> <span class="o">==</span> <span class="n">eP</span><span class="p">)</span>

        <span class="n">eQ</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;b5bea823d9c9ff576091c54b7c596c0ae296884f0e150290e88455d7fba6126f&quot;</span><span class="p">)</span>
        <span class="n">_Q</span>  <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">eQ</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">_Q</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mh">0x6f12a6fbd75584e89002150e4f8896e20a6c597c4bc5916057ffc9d923a8beb5</span><span class="p">)</span>
        <span class="n">_eQ</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">_Q</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">_eQ</span> <span class="o">==</span> <span class="n">eQ</span><span class="p">)</span>

        <span class="c1">#0x449a44ba44226a50185afcc10a4c1462dd5e46824b15163b9d7c52f06be346a0</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;a546e36bf0527c9d3b16154b82465edd62144c0ac1fc5a18506a2244ba449ac4&quot;</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">TwistedEdwardCurve</span><span class="o">.</span><span class="n">decode_scalar_25519</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">k</span> <span class="o">==</span> <span class="mh">0x449a44ba44226a50185afcc10a4c1462dd5e46824b15163b9d7c52f06be346a0</span><span class="p">)</span>

        <span class="n">eP</span> <span class="o">=</span>  <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;e6db6867583030db3594c1a424b15f7c726624ec26b3353b10a903a6d0ab1c4c&quot;</span><span class="p">)</span>
        <span class="n">P</span>  <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">eP</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">P</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">34426434033919594451155107781188821651316167215306631574996226621102155684838</span><span class="p">)</span>

        <span class="n">eQ</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;c3da55379de9c6908e94ea4df28d084f32eccf03491c71f754b4075577a28552&quot;</span><span class="p">)</span>
        <span class="n">Q</span>  <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">eQ</span><span class="p">)</span>

        <span class="n">kP</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="n">P</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">kP</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">Q</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ekP</span> <span class="o">=</span>  <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">kP</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">ekP</span> <span class="o">==</span> <span class="n">eQ</span><span class="p">)</span>

        <span class="c1">#------------</span>

        <span class="n">eG</span> <span class="o">=</span>  <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;09&quot;</span><span class="p">)</span>
        <span class="n">G</span>  <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">eG</span><span class="p">)</span>

        <span class="c1">#a8abababababababababababababababababababababababababababababab6b</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;a8abababababababababababababababababababababababababababababab6b&quot;</span><span class="p">)</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">TwistedEdwardCurve</span><span class="o">.</span><span class="n">decode_scalar_25519</span><span class="p">(</span><span class="n">k1</span><span class="p">)</span>


        <span class="n">eQ1</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;e3712d851a0e5d79b831c5e34ab22b41a198171de209b8b8faca23a11c624859&quot;</span><span class="p">)</span>
        <span class="n">Q1</span>  <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">eQ1</span><span class="p">)</span>

        <span class="n">k1G</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">G</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">k1G</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">Q1</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ek1G</span> <span class="o">=</span>  <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">k1G</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">ek1G</span> <span class="o">==</span> <span class="n">eQ1</span><span class="p">)</span>

        <span class="c1">#c8cdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcd4d</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;c8cdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcdcd4d&quot;</span><span class="p">)</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">TwistedEdwardCurve</span><span class="o">.</span><span class="n">decode_scalar_25519</span><span class="p">(</span><span class="n">k2</span><span class="p">)</span>

        <span class="n">eQ2</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="s2">&quot;b5bea823d9c9ff576091c54b7c596c0ae296884f0e150290e88455d7fba6126f&quot;</span><span class="p">)</span>
        <span class="n">Q2</span>  <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">decode_point</span><span class="p">(</span><span class="n">eQ2</span><span class="p">)</span>

        <span class="n">k2G</span> <span class="o">=</span> <span class="n">k2</span><span class="o">*</span><span class="n">G</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">k2G</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">Q2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="n">ek2G</span> <span class="o">=</span>  <span class="n">cv</span><span class="o">.</span><span class="n">encode_point</span><span class="p">(</span><span class="n">k2G</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">ek2G</span> <span class="o">==</span> <span class="n">eQ2</span><span class="p">)</span>


        <span class="c1">#Check xy multiplication</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">)</span>
        <span class="n">k1G</span> <span class="o">=</span> <span class="n">k1</span><span class="o">*</span><span class="n">G</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">k1G</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">Q1</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">k1G</span><span class="o">.</span><span class="n">has_y</span><span class="p">)</span>

        <span class="n">G</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">cv</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">generator</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">cv</span><span class="p">)</span>
        <span class="n">k2G</span> <span class="o">=</span> <span class="n">k2</span><span class="o">*</span><span class="n">G</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">k2G</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">Q2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">k2G</span><span class="o">.</span><span class="n">has_y</span><span class="p">)</span>

        <span class="c1">#Check xy addition</span>
        <span class="n">W1</span> <span class="o">=</span> <span class="p">(</span><span class="n">k1</span><span class="o">+</span><span class="n">k2</span><span class="p">)</span><span class="o">*</span><span class="n">G</span>
        <span class="n">W2</span> <span class="o">=</span> <span class="n">k1G</span><span class="o">+</span><span class="n">k2G</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">W1</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="n">W2</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">W1</span><span class="o">.</span><span class="n">y</span> <span class="o">==</span> <span class="n">W2</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>

        <span class="n">dblG</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">G</span>
        <span class="n">GG</span> <span class="o">=</span> <span class="n">G</span><span class="o">+</span><span class="n">G</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">GG</span> <span class="o">==</span> <span class="n">dblG</span><span class="p">)</span>

        <span class="n">trpG</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">G</span>
        <span class="n">GGG</span> <span class="o">=</span> <span class="n">GG</span><span class="o">+</span><span class="n">G</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">GGG</span> <span class="o">==</span> <span class="n">trpG</span><span class="p">)</span>

        <span class="c1">##OK!</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All internal assert OK!&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">ECPy</a></h1>








<h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2016, Cédric Mesnil.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 2.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>